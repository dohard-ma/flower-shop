<view class="flex-col h-screen overflow-hidden bg-white">
  <!-- 1. 顶部搜索区域 -->
  <view class="px-30 py-20 bg-white">
    <t-search value="{{searchValues}}" placeholder="搜索商品" bind:change="onSearch" />
  </view>
  <!-- 3. 主体内容区 -->
  <view class="flex-row flex-1 overflow-hidden">
    <!-- 左侧分类导航 -->
    <scroll-view scroll-y class="h-full bg-gray w-200 flex-shrink-0">
      <block wx:for="{{sidebarItems}}" wx:key="id">
        <view class="relative flex items-center py-20 px-20 {{ (item.level === 0 && (item.id === expandedParentId || item.id === activeSidebarValue)) || (item.level === 1 && item.parentId === expandedParentId) ? 'bg-white' : '' }}" bind:tap="onCategoryChange" data-id="{{item.id}}">
          <!-- 一级分类选中的左侧竖条指示器 -->
          <view wx:if="{{item.level === 0 && (item.id === expandedParentId || (!item.hasChildren && item.id === activeSidebarValue))}}" class="absolute left-0 top-50p transform-y-50 w-6 h-40 bg-333 rounded-tr-sm"></view>
          <!-- 文本标签 -->
          <view class="{{ item.level === 0 ? (item.id === activeSidebarValue ? 'text-base font-bold text-333' : 'text-base font-bold text-666') : (item.id === activeSidebarValue ? 'text-sm font-bold text-333 pl-30 relative child-active-line' : 'text-sm text-999 pl-30') }}">
            {{item.label}}
          </view>
        </view>
      </block>
    </scroll-view>
    <!-- 右侧商品列表 -->
    <scroll-view scroll-y class="flex-1 h-full bg-white px-20 pt-30 pb-20" bindscrolltolower="onScrollToLower">
      <!-- 当前选中分类的大标题 -->
      <view class="text-lg font-bold mb-30 ml-10 text-333">{{activeSidebarItem.label || ''}}</view>
      <!-- 商品网格 -->
      <view class="flex-row flex-wrap justify-start gap-20">
        <block wx:for="{{displayProducts}}" wx:key="id">
          <view class="flex-col mb-40 w-235">
            <view class="relative rounded-md overflow-hidden bg-gray h-320">
              <image src="{{item.images[0]}}" mode="aspectFill" class="full-w full-h" />
            </view>
            <view class="mt-15 px-5">
              <view class="text-base font-bold text-333 truncate">{{item.name}}</view>
              <view class="text-xs text-999 truncate mt-5">{{item.description}}</view>
              <view class="flex-row justify-between items-center mt-15">
                <view class="flex-row items-center">
                  <text class="text-xs font-bold text-333">¥</text>
                  <text class="text-lg font-bold text-333 ml-5">{{item.priceRef}}</text>
                </view>
                <t-icon name="add-circle-filled" size="44rpx" color="#333" />
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{displayProducts.length === 0 && !loading}}" class="full-w py-100 text-center text-999 text-sm">
          该分类下暂无商品
        </view>
        <!-- 加载更多状态 -->
        <view wx:if="{{pagination.loadingMore}}" class="full-w py-20 text-center text-999 text-xs">
          正在加载更多...
        </view>
        <view wx:if="{{!pagination.hasMore && displayProducts.length > 0}}" class="full-w py-20 text-center text-ccc text-xs">
          没有更多商品了
        </view>
      </view>
      <view class="h-100"></view>
    </scroll-view>
  </view>
</view>