<view class="flex-col h-screen overflow-hidden bg-white">
  <view class="px-30 py-20 bg-white">
    <t-search value="{{searchValues}}" placeholder="搜索商品" bind:change="onSearch" />
  </view>

  <view class="flex-row flex-1 overflow-hidden">
    <scroll-view scroll-y class="h-full bg-gray w-200 flex-shrink-0">
      <block wx:for="{{sidebarItems}}" wx:key="id">
        <view class="relative flex items-center py-20 px-30 {{ (item.level === 0 && (item.id === expandedParentId || item.id === activeSidebarValue)) || (item.level === 1 && item.parentId === expandedParentId) ? 'bg-white' : '' }}" bind:tap="onCategoryChange" data-id="{{item.id}}">

          <view
            wx:if="{{item.level === 0 && (item.id === expandedParentId || (!item.hasChildren && item.id === activeSidebarValue))}}"
            class="absolute left-0 bg-brand"
            style="top: 50%; left: 8rpx; transform: translateY(-50%); width: 6rpx; height: 40rpx; border-radius: 0 4rpx 4rpx 0;"
          ></view>

          <view class="{{ item.level === 0 ? (item.id === activeSidebarValue ? 'text-base text-main' : 'text-base text-sub') : (item.id === activeSidebarValue ? 'text-sm text-main pl-30 relative child-active-line' : 'text-sm text-placeholder pl-30') }}">
            {{item.label}}
          </view>
        </view>
      </block>
    </scroll-view>

    <scroll-view scroll-y class="flex-1 h-full bg-white px-20 pt-30 pb-20" bindscrolltolower="onScrollToLower">
      <view class="text-lg font-bold mb-30 ml-10 text-main">{{activeSidebarItem.label || ''}}</view>

      <view class="flex-row flex-wrap justify-start gap-20">
        <block wx:for="{{displayProducts}}" wx:key="id">
          <view class="flex-col mb-40" style="width: 235rpx;">
            <view class="relative rounded-md overflow-hidden bg-gray" style="height: 320rpx;">
              <image src="{{item.images[0]}}" mode="aspectFill" class="w-full h-full" />
            </view>

            <view class="mt-20 px-4">
              <view class="text-base font-bold text-main truncate">{{item.name}}</view>
              <view class="text-xs text-placeholder truncate mt-4">{{item.description}}</view>

              <view class="flex-row justify-between items-center mt-20">
                <view class="flex-row items-center">
                  <text class="text-xs font-bold text-main">¥</text>
                  <text class="text-lg font-bold text-main ml-4">{{item.priceRef}}</text>
                </view>
                <t-icon name="add-circle-filled" size="44rpx" color="#333" />
              </view>
            </view>
          </view>
        </block>

        <view wx:if="{{displayProducts.length === 0 && !loading}}" class="w-full py-100 text-center text-placeholder text-sm">
          该分类下暂无商品
        </view>

        <view wx:if="{{pagination.loadingMore}}" class="w-full py-20 text-center text-placeholder text-xs">
          正在加载更多...
        </view>
        <view wx:if="{{!pagination.hasMore && displayProducts.length > 0}}" class="w-full py-20 text-center text-placeholder text-xs">
          没有更多商品了
        </view>
      </view>

      <view class="h-100"></view>
    </scroll-view>
  </view>
</view>